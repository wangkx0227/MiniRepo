{% extends 'dashboard/workbenches.html' %}
<!-- {{ super() }} 继承父类的内容不重写,而是增加 -->
{% block main_navigation_bar %}
{{ super() }}
<span>/</span>
<span><a href="javascript:void(0);">概览</a></span>
{% endblock main_navigation_bar %}
{% block css %}
<link rel="stylesheet" href="{{ url_for('dashboard.static', filename='workbenches/overview/overview.css') }}">
<style>
    .dynamics-content {
        min-height: 300px;
    }

    .event-line {
        position: relative;
        border-left: 1px solid #e3e9ed;
    }

    .time-line-group {
        padding-left: 15px;
        margin-bottom: 30px;
    }

    .time-line-items {
        margin-left: 0;
        padding-left: 0;
        list-style: none;
    }

    .time-line-item {
        gap: 5px;
        display: flex;
        font-size: 14px;
        align-items: center;
        margin-bottom: 18px;
        flex-direction: row;
    }

    .time-line-item s-avatar {
        height: 20px;
        width: 20px
    }

    .time-line-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .time-line-group a {
        text-decoration: none; /* 默认无下划线 */
        color: #005980;
    }

    .time-line-meta {
        font-size: 14px;
        margin-left: 10px;
        flex-shrink: 0;
    }

    .dynamics-loading {
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

</style>
{% endblock css %}
{% block workbenches_content %}
<div class="main-contribute">
    <div class="contribute-head"
         style="margin-top:2em;display: flex;justify-content: space-between;align-items: center;">
        <h3 class="fonts-color-major">贡献度</h3>
        <div>
            <s-picker label="日期">
                <s-picker-item value="gui yang" selectd="select">2025</s-picker-item>
                <s-picker-item value="bei jing">2024</s-picker-item>
                <s-picker-item value="shang hai">2023</s-picker-item>
                <s-picker-item value="shen zhen">2022</s-picker-item>
                <s-picker-item value="cheng du">2021</s-picker-item>
                <s-picker-item value="wu han">2020</s-picker-item>
            </s-picker>
        </div>
    </div>
    <div class="contribute-content">
        <div class="calendar-wrap">
            <div class="weekdays fonts-color-minor" id="weekdays"></div>
            <div class="calendar">
                <div class="months" id="months"></div>

                <div class="weeks" id="calendar">
                </div>
            </div>
        </div>
        <div class="legend fonts-color-routine">
            <span>少</span>
            <span class="legend-box level-0"></span>
            <span class="legend-box level-1"></span>
            <span class="legend-box level-2"></span>
            <span class="legend-box level-3"></span>
            <span class="legend-box level-4"></span>
            <span>多</span>
        </div>
        <div class="describe">
            <p class="fonts-color-minor" style="display: inline-block;margin-right: 20px;font-size: 12px;">
                最近一年贡献：49 次</p>
            <p class="fonts-color-minor" style="display: inline-block;margin-right: 20px;font-size: 12px;">最长连续贡献：5
                日</p>
            <p class="fonts-color-minor" style="display: inline-block;margin-right: 20px;font-size: 12px;">最近连续贡献：5
                日</p>
            <p style="margin: 0;font-size: 12px;" class="fonts-color-routine">
                贡献度的统计数据包括代码提交、创建任务 / Pull Request、合并 Pull Request，其中代码提交的次数需本地配置的 git 邮箱帐号已确认绑定的才会被统计。
            </p>
        </div>
    </div>
</div>
<div class="main-dynamics">
    <div class="dynamics-head">
        <h3 class="fonts-color-major">动态</h3>
    </div>
    <div class="dynamics-content">
        {% if data %}
        <div class="event-line">
            {% for event in data.event_list %}
            <div class="time-line-group">
                <div class="fonts-color-major">{{ event.date }}</div>
                <ul class="time-line-items fonts-color-major">
                    {% for commit in event.save_commit_list %}
                    <li class="time-line-item">
                        <!--更新上传信息-->
                        <div class="time-line-content fonts-color-routine">
                            <div>
                                <span>推送到了</span>
                                <a href="{{ commit.project_tree_path }}">{{ commit.name_with_namespace }}</a>
                                <span>的 {{ commit.branch_name}} 分支</span>
                            </div>
                            <div>
                                <s-avatar src="{{ commit.profile_photo_link }}"></s-avatar><!--头像-->
                                <span><a href="{{ commit.project_commit_path }}">{{ commit.commit_from }}</a></span>
                                <span>{{ commit.message }}</span>
                            </div>
                        </div>
                        <div class="time-line-meta fonts-color-minor">{{ commit.create_at_date | do_date_differ}}</div>
                    </li>
                    {% endfor %}
                    <!--展示按钮-->
                    <li style=" font-size: 14px;margin-top: 5px" class="fonts-color-minor">
                        <span>已隐藏 5 条推送信息，</span>
                        <a href="#" style="color: #409EFF;">展开查看</a>
                    </li>
                </ul>
            </div>
            {% endfor %}

        </div>
        <div style="height: 80px">
            <s-button style="display: flex;border-radius: 0;" type="outlined" id="TimeLineLoadMore">
                加载更多
            </s-button>
        </div>
        {% else %}
        <s-empty style="min-height: 300px">暂时没有数据</s-empty>
        {% endif %}
    </div>
</div>
{% endblock workbenches_content %}
{% block js_end %}
{{ super() }}
<script src="{{ url_for('dashboard.static', filename='workbenches/overview/overview.js') }}"></script>
<script>
    const TimeLineLoadMore = document.getElementById("TimeLineLoadMore")
    TimeLineLoadMore.addEventListener("click", () => {
        TimeLineLoadMore.innerHTML = `<s-circular-progress indeterminate="true" slot="start"></s-circular-progress>`

        setTimeout(()=>{
            TimeLineLoadMore.innerText = "加载更多"
        },2000)
    })
</script>
{% endblock js_end %}