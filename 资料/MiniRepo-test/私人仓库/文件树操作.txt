è¦åœ¨ä½ çš„ä»£ç æäº¤å¹³å°ä¸­å®ç° **â€œæ˜¾ç¤ºä»£ç æ–‡ä»¶æ ‘ / æµè§ˆæ–‡ä»¶â€**ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ï¼š

1. ä½¿ç”¨ Python è¯»å– Git ä»“åº“ä¸­çš„æŸæ¬¡æäº¤ï¼ˆcommit æˆ–åˆ†æ”¯ HEADï¼‰
2. è·å–è¯¥æäº¤å¯¹åº”çš„æ–‡ä»¶æ ‘ï¼ˆtreeï¼‰
3. æ¸²æŸ“æ–‡ä»¶å’Œç›®å½•ç»“æ„
4. ç”¨æˆ·ç‚¹å‡»æ–‡ä»¶åå¯ä»¥æŸ¥çœ‹å…¶å†…å®¹

---

## âœ… æŠ€æœ¯è·¯çº¿ï¼ˆä»¥ Flask + GitPython ä¸ºä¾‹ï¼‰

ä½ å¯ä»¥ä½¿ç”¨ [GitPython](https://gitpython.readthedocs.io/) æ¥æ“ä½œ Git ä»“åº“ã€‚å®ƒèƒ½è¯»å–æŒ‡å®šæäº¤çš„æ–‡ä»¶æ ‘ï¼Œéå¸¸é€‚åˆç”¨äºä»£ç æµè§ˆã€‚

---

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install GitPython
```

---

## ğŸ—‚ï¸ ç¤ºä¾‹é¡¹ç›®ç»“æ„ï¼ˆä»“åº“è·¯å¾„ï¼‰

```
repos/
â””â”€â”€ user1/
    â””â”€â”€ testrepo.git/    â† ä½¿ç”¨ git init --bare åˆå§‹åŒ–
```

ä½ å¯ä»¥å°†ä»“åº“ clone ä¸€ä»½åˆ° `workdir/` ä¾›æµè§ˆæˆ–ç¼–è¾‘æ“ä½œï¼ˆå› ä¸º bare ä»“åº“ä¸èƒ½ checkoutï¼‰ã€‚

---

## ğŸ§© Flask ç¤ºä¾‹ä»£ç ï¼šæ˜¾ç¤ºæ–‡ä»¶æ ‘

```python
from flask import Flask, render_template
import os
from git import Repo

app = Flask(__name__)

REPO_BASE_PATH = "./repos/user1/testrepo"  # è¿™æ˜¯ clone åçš„éè£¸ä»“åº“è·¯å¾„

@app.route("/repo/<repo_name>/tree/<path:tree_path>")
@app.route("/repo/<repo_name>/tree/", defaults={"tree_path": ""})
def browse_tree(repo_name, tree_path):
    repo_path = os.path.join(REPO_BASE_PATH)
    repo = Repo(repo_path)
    commit = repo.head.commit
    tree = commit.tree

    # å¯¼èˆªåˆ°å­ç›®å½•
    parts = tree_path.strip("/").split("/") if tree_path else []
    for part in parts:
        tree = tree / part

    items = []
    for item in tree:
        items.append({
            "name": item.name,
            "type": "tree" if item.type == "tree" else "blob",
            "path": os.path.join(tree_path, item.name)
        })

    return render_template("tree.html", items=items, repo=repo_name, tree_path=tree_path)
```

---

## ğŸ“„ `tree.html` ç¤ºä¾‹æ¨¡æ¿ï¼ˆä½¿ç”¨ Bootstrapï¼‰

```html
<h2>Repository: {{ repo }}</h2>
<ul>
  {% for item in items %}
    {% if item.type == 'tree' %}
      <li>
        ğŸ“ <a href="{{ url_for('browse_tree', repo_name=repo, tree_path=item.path) }}">{{ item.name }}/</a>
      </li>
    {% else %}
      <li>
        ğŸ“„ <a href="{{ url_for('view_file', repo_name=repo, file_path=item.path) }}">{{ item.name }}</a>
      </li>
    {% endif %}
  {% endfor %}
</ul>
```

---

## ğŸ“„ åŠ ä¸Šæµè§ˆæ–‡ä»¶å†…å®¹æ¥å£

```python
@app.route("/repo/<repo_name>/blob/<path:file_path>")
def view_file(repo_name, file_path):
    repo = Repo(REPO_BASE_PATH)
    commit = repo.head.commit
    tree = commit.tree

    # å¯¼èˆªåˆ°æ–‡ä»¶ blob
    parts = file_path.strip("/").split("/")
    blob = tree
    for part in parts:
        blob = blob / part

    content = blob.data_stream.read().decode("utf-8", errors="ignore")
    return render_template("file.html", content=content, file_path=file_path)
```

---

## ğŸ“„ `file.html` ç¤ºä¾‹æ¨¡æ¿

```html
<h3>{{ file_path }}</h3>
<pre style="background: #f8f9fa; padding: 10px; border: 1px solid #ccc;">
{{ content }}
</pre>
```

---

## âœ… æœ€ç»ˆå®ç°æ•ˆæœï¼š

* ä½ è®¿é—® `/repo/testrepo/tree/`ï¼šæ˜¾ç¤ºæ ¹ç›®å½•æ–‡ä»¶æ ‘
* ç‚¹å‡»ç›®å½•ï¼šè·³è½¬åˆ° `/repo/testrepo/tree/src/`
* ç‚¹å‡»æ–‡ä»¶ï¼šè·³è½¬åˆ° `/repo/testrepo/blob/src/main.py`ï¼Œæ˜¾ç¤ºä»£ç å†…å®¹

---

## ğŸ“Œ æ€»ç»“ï¼šä½ å®ç°â€œä»£ç æµè§ˆå™¨â€æ‰€éœ€çš„è¦ç‚¹

| åŠŸèƒ½     | æŠ€æœ¯å®ç°æ–¹å¼                                 |
| ------ | -------------------------------------- |
| è¯»å–ä»“åº“å†…å®¹ | `GitPython` è·å– `repo.head.commit.tree` |
| æ˜¾ç¤ºæ–‡ä»¶ç»“æ„ | éå† `tree`ï¼Œç”Ÿæˆæ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨                   |
| æ–‡ä»¶å†…å®¹å±•ç¤º | è¯»å– `Blob.data_stream.read()` è§£ç å¹¶å±•ç¤º     |
| å¤šçº§ç›®å½•å¯¼èˆª | é€šè¿‡é€’å½’è·¯å¾„éå†æ ‘èŠ‚ç‚¹                            |
| é¡µé¢å±•ç¤º   | ç”¨ Flask æ¨¡æ¿æ¸²æŸ“ï¼ŒJinja2 ç”Ÿæˆ HTML            |

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸ºä½ å†™ä¸€ä»½å®Œæ•´çš„æ–‡ä»¶æµè§ˆè“å›¾ï¼ˆBlueprintï¼‰ï¼Œä½ åªéœ€å¼•å…¥è¿›ä½ çš„é¡¹ç›®å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚è¦æˆ‘ç»§ç»­ç”Ÿæˆè¿™éƒ¨åˆ†ä»£ç å—ï¼Ÿ





è£¸ä»“åº“ä¸è£¸ä»“åº“
ä½ è¿™æŠ¥é”™çš„æ ¸å¿ƒåŸå› æ˜¯ï¼š

> `git.exc.NoSuchPathError` è¡¨ç¤ºä½ ç”¨ GitPython è®¿é—®çš„è·¯å¾„ **ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„éè£¸ä»“åº“è·¯å¾„**ã€‚

---

### é‡ç‚¹åŒºåˆ«ï¼šè£¸ä»“åº“ï¼ˆbare repoï¼‰å’Œéè£¸ä»“åº“ï¼ˆworking repoï¼‰

* **è£¸ä»“åº“**ï¼ˆ`testrepo.git`ï¼Œé€šè¿‡ `git init --bare` åˆ›å»ºï¼‰æ˜¯æ²¡æœ‰å·¥ä½œåŒºçš„ï¼Œé‡Œé¢åªæœ‰ Git å…ƒæ•°æ®å’Œå¯¹è±¡ã€‚
* **éè£¸ä»“åº“** æ˜¯ä½  `git clone` å‡ºæ¥çš„ç›®å½•ï¼Œæœ‰å®Œæ•´çš„å·¥ä½œåŒºï¼Œå¯ä»¥ç›´æ¥è®¿é—®æ–‡ä»¶ã€‚

---

### ä½ çš„é—®é¢˜

* ä½ ç»™ GitPython ä¼ å…¥äº†è£¸ä»“åº“è·¯å¾„ `testrepo.git`ï¼ŒGitPython é»˜è®¤è¦æ±‚æ˜¯éè£¸ä»“åº“è·¯å¾„ï¼ˆæœ‰å·¥ä½œåŒºï¼‰ã€‚
* è£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºæ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥ç”¨ GitPython çš„ `repo.head.commit.tree` è®¿é—®æ–‡ä»¶æ ‘ã€‚

---

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šåœ¨æœåŠ¡å™¨ç»´æŠ¤éè£¸ä»“åº“å‰¯æœ¬ç”¨äºæµè§ˆ

* **å·¥ä½œæµ**ï¼š

  1. ä½ åœ¨ `repos/user1/testrepo.git` æ˜¯è£¸ä»“åº“ï¼Œä½œä¸ºè¿œç¨‹ä»“åº“ï¼ˆpush/pull ç”¨ï¼‰ã€‚
  2. æ–°å»ºä¸€ä¸ªéè£¸ä»“åº“ `repos/user1/testrepo`ï¼Œè¿™æ˜¯è£¸ä»“åº“çš„å…‹éš†ï¼ˆæˆ–è€…ç”¨ `git clone` å‘½ä»¤åŒæ­¥ï¼‰ã€‚
  3. æµè§ˆæ—¶ç”¨ GitPython æ‰“å¼€ `repos/user1/testrepo`ï¼ˆéè£¸ä»“åº“ï¼‰è¯»å–æ–‡ä»¶æ ‘ã€‚

* **ç¤ºä¾‹æ“ä½œ**ï¼š

```bash
cd repos/user1
git clone testrepo.git testrepo
```

è¿™æ ·ä¼šç”Ÿæˆ `testrepo`ï¼ˆéè£¸ä»“åº“ï¼‰ï¼ŒGitPython å°±èƒ½æ­£å¸¸è®¿é—®äº†ã€‚

---

#### æ–¹æ¡ˆäºŒï¼šç›´æ¥ç”¨è£¸ä»“åº“æ“ä½œï¼ˆé«˜çº§ï¼Œä½¿ç”¨ gitdbï¼‰

è£¸ä»“åº“æ“ä½œè¾ƒå¤æ‚ï¼Œä¸å»ºè®®ç›´æ¥ç”¨ GitPython è®¿é—®æ–‡ä»¶å†…å®¹ã€‚
ä½ éœ€è¦ç”¨åº•å±‚çš„ `gitdb`ï¼Œè€Œä¸”æ–‡ä»¶å†…å®¹ä¸æ˜¯å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¾—ä»å¯¹è±¡æ•°æ®åº“è¯»å–ã€‚

---

### æ¨èåšæ³•

ä¿æŒè£¸ä»“åº“ä½œä¸ºè¿œç¨‹æ¨é€çš„åœ°æ–¹ï¼ŒæœåŠ¡å™¨ä¸Šç»´æŠ¤å¯¹åº”çš„éè£¸ä»“åº“åšæµè§ˆå’Œå±•ç¤ºã€‚

---

### ä»£ç ç¤ºä¾‹æ”¹ä¸ºä½¿ç”¨éè£¸ä»“åº“

```python
REPO_BASE_PATH = "./repos/user1/testrepo"  # éè£¸ä»“åº“è·¯å¾„ï¼Œéœ€å­˜åœ¨å·¥ä½œåŒºæ–‡ä»¶
```

ç¡®ä¿ä½ è¿è¡Œï¼š

```bash
cd repos/user1
git clone testrepo.git testrepo
```

ç„¶åå¯åŠ¨ Flask å†è®¿é—®ã€‚

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ å†™ä¸ª**è‡ªåŠ¨åŒæ­¥è£¸ä»“åº“å˜åŒ–åˆ°éè£¸ä»“åº“**çš„è„šæœ¬ï¼ˆæ¯”å¦‚é€šè¿‡ `git fetch` æˆ–é’©å­è‡ªåŠ¨æ›´æ–°ï¼‰ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ å†™ã€‚è¿™æ ·ä½ æµè§ˆçš„å†…å®¹å°±æ˜¯æœ€æ–°çš„ã€‚

---

éœ€è¦æˆ‘å¸®ä½ å†™è¿™å—ä»£ç å—ï¼Ÿ
